<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Grow NOC • דוח עסקאות לפי סוג</title>

  <style>
    :root{
      --bg:#121065;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.12);
      --text:#ffffff;
      --muted:rgba(255,255,255,.65);
      --line:rgba(255,255,255,.14);
      --accent:#ECEBFE;
      --good:#3cffb0;
      --bad:#ff6b6b;
    }

    *{ box-sizing:border-box }

    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 80% 10%, rgba(236,235,254,.12), transparent 60%),
        radial-gradient(900px 600px at 20% 90%, rgba(236,235,254,.08), transparent 55%),
        var(--bg);
    }

    .wrap{
      min-height:100vh;
      padding:28px;
      display:grid;
      grid-template-rows:auto 1fr auto;
      gap:18px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
    }

    .title{
      display:flex;
      align-items:center;
      gap:14px;
    }

    h1{ margin:0; font-size:36px }

    .badge{
      background:var(--accent);
      color:#121065;
      padding:6px 14px;
      border-radius:999px;
      font-weight:800;
      font-size:14px;
    }

    .meta{
      text-align:left;
      font-size:14px;
      color:var(--muted);
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .status.ok{ color:var(--good) }
    .status.err{ color:var(--bad) }

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:18px;
    }

    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.1),rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:18px;
      padding:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }

    .card h2{
      margin:0 0 12px 0;
      display:flex;
      justify-content:space-between;
      font-size:22px;
    }

    .sub{ color:var(--muted); font-size:13px }

    /* ===== TABLE ===== */
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:14px;
      font-size:18px;
    }

    thead tr{ background:rgba(236,235,254,.12) }

    thead th{
      font-size:20px;
      font-weight:900;
      padding:16px 12px;
      border-bottom:2px solid rgba(236,235,254,.55);
      text-shadow:0 2px 12px rgba(0,0,0,.35);
    }

    tbody td{
      padding:14px 12px;
      border-bottom:1px solid var(--line);
    }

    tbody tr:last-child td{ border-bottom:none }

    th.type,td.type{ width:48%; text-align:right; padding-right:18px }
    th.count,td.count{ width:20%; text-align:left }
    th.amount,td.amount{ width:32%; text-align:left }

    tr.total-row{
      background:rgba(236,235,254,.15);
      font-weight:800;
    }

    /* ===== TOTAL KPI ===== */
    .totals{
      display:flex;
      justify-content:center;
      gap:16px;
      margin-top:18px;
    }

    .pill{
      background:rgba(236,235,254,.18);
      border:1px solid rgba(236,235,254,.45);
      border-radius:14px;
      padding:14px 22px;
      min-width:160px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:4px;
    }

    .pill span{
      font-size:13px;
      color:var(--muted);
      letter-spacing:.3px;
    }

    .pill b{
      font-size:22px;
      font-weight:900;
      color:#fff;
    }

    .pill.amount{
      background:linear-gradient(
        180deg,
        rgba(236,235,254,.35),
        rgba(236,235,254,.18)
      );
      border-color:rgba(236,235,254,.7);
    }

    .pill.negative{
      background:linear-gradient(
        180deg,
        rgba(255,90,90,.35),
        rgba(255,90,90,.18)
      );
      border-color:rgba(255,90,90,.7);
    }

    footer{
      border-top:1px solid var(--line);
      padding-top:14px;
      font-size:13px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
    }

    @media (max-width:1100px){
      .grid{ grid-template-columns:1fr }
      h1{ font-size:28px }
    }
  </style>
</head>

<body>
<div class="wrap">

<header>
  <div class="title">
    <h1>דוח עסקאות לפי סוג</h1>
    <div class="badge">GROW • NOC</div>
  </div>
  <div class="meta">
    <div id="updatedAt">עודכן: —</div>
    <div id="status" class="status">טוען…</div>
  </div>
</header>

<main class="grid">

  <!-- MTD -->
  <section class="card">
    <h2><span>(MTD) מהחודש</span><span class="sub">Start of month</span></h2>
    <table>
      <thead>
        <tr>
          <th class="type">סוג</th>
          <th class="count">כמות</th>
          <th class="amount">סליקה</th>
        </tr>
      </thead>
      <tbody id="monthBody"></tbody>
    </table>
    <div class="totals">
      <div class="pill"><span>סה״כ כמות</span><b id="monthCount">—</b></div>
      <div class="pill amount" id="monthAmountPill"><span>סה״כ סכום</span><b id="monthAmount">—</b></div>
    </div>
  </section>

  <!-- TODAY -->
  <section class="card">
    <h2><span>(Today) מהיום</span><span class="sub">Start of day</span></h2>
    <table>
      <thead>
        <tr>
          <th class="type">סוג</th>
          <th class="count">כמות</th>
          <th class="amount">סליקה</th>
        </tr>
      </thead>
      <tbody id="todayBody"></tbody>
    </table>
    <div class="totals">
      <div class="pill"><span>סה״כ כמות</span><b id="todayCount">—</b></div>
      <div class="pill amount" id="todayAmountPill"><span>סה״כ סכום</span><b id="todayAmount">—</b></div>
    </div>
  </section>

</main>

<footer>
  <div>רענון אוטומטי כל 5 דקות</div>
  <div>/latest.json</div>
</footer>

</div>

<script>
  const URL="/latest.json";
  const REFRESH_MIN=5;

  const fmt=n=>typeof n==="number"?n.toLocaleString("he-IL"):"—";

  function render(rows, id){
    const tbody=document.getElementById(id);
    tbody.innerHTML=rows.map(r=>{
      const isTotal=r.type.includes("סה");
      return `<tr class="${isTotal?"total-row":""}">
        <td class="type">${r.type}</td>
        <td class="count">${fmt(r.count)}</td>
        <td class="amount">${fmt(r.amount)}</td>
      </tr>`;
    }).join("");
  }

  const sum=(rows,k)=>rows.reduce((s,r)=>s+(typeof r[k]==="number"?r[k]:0),0);

  async function load(){
    try{
      const res=await fetch(URL+"?v="+Date.now(),{cache:"no-store"});
      const data=await res.json();

      updatedAt.innerText="עודכן: "+data.updatedAt;

      const t=data.transactions.today;
      const m=data.transactions.month;

      render(t,"todayBody");
      render(m,"monthBody");

      const tc=sum(t,"count"), ta=sum(t,"amount");
      const mc=sum(m,"count"), ma=sum(m,"amount");

      todayCount.innerText=fmt(tc);
      todayAmount.innerText=fmt(ta);
      monthCount.innerText=fmt(mc);
      monthAmount.innerText=fmt(ma);

      todayAmountPill.classList.toggle("negative",ta<0);
      monthAmountPill.classList.toggle("negative",ma<0);

      status.innerText="עודכן בהצלחה";
      status.className="status ok";
    }catch{
      status.innerText="שגיאה בטעינה";
      status.className="status err";
    }
  }

  load();
  setInterval(load,REFRESH_MIN*60*1000);
</script>

</body>
</html>
